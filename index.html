<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Seamless Dash - Seamex</title>

<style>
:root { --red:#A01018; --gold:#FFC107; --sky:#e3f2fd; --blue:#0984e3; }
body,html{margin:0;padding:0;width:100%;height:100%;overflow:hidden;background:#000;font-family:'Segoe UI',sans-serif;touch-action:none}
canvas{position:absolute;inset:0;z-index:2;width:100%;height:100%}
#ui-layer{position:absolute;inset:0;z-index:10;pointer-events:none;display:flex;align-items:center;justify-content:center}
.screen-box{background:rgba(255,255,255,.98);padding:25px;border-radius:30px;width:88%;max-width:360px;text-align:center;pointer-events:auto;box-shadow:0 15px 45px rgba(0,0,0,.3);border-top:8px solid var(--red);display:none;flex-direction:column;max-height:90vh;overflow-y:auto}
body.state-menu #start-screen{display:flex}
body.state-gameover #game-over-screen{display:flex}
body.state-playing #game-hud{display:flex!important}
.logo{width:130px;margin:0 auto 10px}
.title{color:var(--red);font-size:24px;font-weight:900;margin:0;text-transform:uppercase}
.input-group{margin-bottom:5px;text-align:left}
input{width:100%;padding:14px;border:2px solid #eee;border-radius:12px;font-size:16px}
.nudge{color:var(--red);font-size:11px;font-weight:700;margin-top:4px;visibility:hidden;height:12px}
.main-btn{background:linear-gradient(135deg,var(--gold),var(--red));color:#fff;border:none;padding:16px;border-radius:50px;font-weight:800;width:100%;cursor:pointer;font-size:16px;margin-top:10px}
.main-btn:disabled{opacity:.4;filter:grayscale(1);cursor:not-allowed}
.text-btn{background:none;border:none;color:var(--red);font-weight:700;cursor:pointer;margin-top:10px;font-size:13px;text-decoration:underline}
.how-to{background:#f0f9ff;padding:12px;border-radius:15px;margin:15px 0;text-align:left;border:1px solid #d1e9ff;font-size:12px}
.hud-top{position:absolute;top:15px;width:92%;left:4%;display:flex;justify-content:space-between}
.stat-pill{background:rgba(255,255,255,.9);padding:8px 15px;border-radius:20px;font-weight:800;color:var(--red);font-size:12px;border:1px solid #eee}
#game-hud{position:absolute;inset:0;display:none;pointer-events:none;z-index:5}
#start-toast{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,.75);color:#fff;padding:15px 25px;border-radius:50px;font-weight:800;font-size:18px}
#shield-toast{position:absolute;top:65px;left:50%;transform:translateX(-50%);background:var(--blue);color:#fff;padding:6px 18px;border-radius:30px;font-weight:800;font-size:12px;display:none}
</style>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>

<body class="state-menu">

<div style="display:none">
<img id="asset-player" src="character.png">
<img id="asset-v1" src="icons8-virus-60.png">
<img id="asset-v2" src="icons8-virus-60 (1).png">
<img id="asset-shield" src="sheild.png">
<img id="asset-cloud" src="cloud1.png">
</div>

<div id="ui-layer">
<div id="start-screen" class="screen-box">
<img src="NEW Seamex logo.png" class="logo">
<h1 class="title">Seamless Dash</h1>

<div id="welcome-back" style="display:none">
<div><span id="time-greeting"></span>, <strong id="user-name"></strong></div>
<button class="main-btn" id="btn-quick-start">START DASHING</button>
<button class="text-btn" id="btn-change">Change User</button>
</div>

<div id="login-form">
<div class="input-group">
<input id="inp-name" placeholder="Full Name">
<div id="nudge-name" class="nudge">Letters only (min 3)</div>
</div>
<div class="input-group">
<input id="inp-id" placeholder="Poornata ID">
<div id="nudge-id" class="nudge">Numbers only (4-10 digits)</div>
</div>
<button id="btn-login" class="main-btn" disabled>ENTER SKY</button>
</div>
</div>

<div id="game-over-screen" class="screen-box">
<h1 class="title">Dash Over</h1>
<button id="btn-restart" class="main-btn">DASH AGAIN</button>
<button id="btn-menu" class="text-btn">Back to Menu</button>
</div>
</div>

<div id="game-hud">
<div class="hud-top">
<div class="stat-pill">‚≠ê <span id="val-score">0</span></div>
<div class="stat-pill">Level <span id="val-lvl">1</span></div>
<div class="stat-pill">Best <span id="val-best">0</span></div>
</div>
<div id="start-toast">PLACE FINGER TO START</div>
<div id="shield-toast">üõ°Ô∏è <span id="shield-timer">8.0</span>s</div>
</div>

<canvas id="gameCanvas"></canvas>

<script>
/* ====== FIREBASE ====== */
firebase.initializeApp({
apiKey:"AIzaSyBJcK4zEK2Rb-Er8O7iDNYsGW2HUJANPBc",
authDomain:"seamless-dash.firebaseapp.com",
projectId:"seamless-dash"
});
const db=firebase.firestore();

/* ====== ENCRYPTION ====== */
const SD_SECRET="SD_PRASIDHA_JAGTAP_V38_MASTER_KEY";
async function encryptText(t){
const iv=crypto.getRandomValues(new Uint8Array(12));
const key=await crypto.subtle.importKey("raw",await crypto.subtle.digest("SHA-256",new TextEncoder().encode(SD_SECRET)),{name:"AES-GCM"},false,["encrypt"]);
const enc=await crypto.subtle.encrypt({name:"AES-GCM",iv},key,new TextEncoder().encode(t));
return{iv:btoa(String.fromCharCode(...iv)),data:btoa(String.fromCharCode(...new Uint8Array(enc)))}
}
async function hashPoornataId(pid){
const d=await crypto.subtle.digest("SHA-256",new TextEncoder().encode(pid+"SEAMLESS_DASH_V38"));
return Array.from(new Uint8Array(d)).map(b=>b.toString(16).padStart(2,"0")).join("");
}

/* ====== STATE ====== */
const STATE={phase:"MENU",user:null,score:0,highscore:0};

/* ====== INIT USER (FIXED) ====== */
async function initUser(){
const saved=localStorage.getItem("seamex_user_v38");
if(!saved)return;
STATE.user=JSON.parse(saved);
document.getElementById("user-name").textContent=STATE.user.name.split(" ")[0];
document.getElementById("welcome-back").style.display="block";
document.getElementById("login-form").style.display="none";
}

/* ====== LOGIN ====== */
const nameIn=document.getElementById("inp-name");
const idIn=document.getElementById("inp-id");
const loginBtn=document.getElementById("btn-login");

function validate(){
const ok=/^[A-Za-z\s]{3,}$/.test(nameIn.value)&&/^[0-9]{4,10}$/.test(idIn.value);
loginBtn.disabled=!ok;
}
["input","keyup","change"].forEach(e=>{
nameIn.addEventListener(e,validate);
idIn.addEventListener(e,validate);
});

loginBtn.onclick=async()=>{
STATE.user={name:nameIn.value.trim(),id:idIn.value.trim()};
localStorage.setItem("seamex_user_v38",JSON.stringify(STATE.user));
const pidHash=await hashPoornataId(STATE.user.id);
const enc=await encryptText(STATE.user.id);
await db.collection("players").doc(pidHash).set({
name:STATE.user.name,
pid_enc:enc.data,
pid_iv:enc.iv,
highScore:0,
lastSeen:Date.now()
},{merge:true});
location.reload();
};

document.getElementById("btn-change").onclick=()=>{
localStorage.removeItem("seamex_user_v38");
location.reload();
};

initUser();

Object.defineProperty(window,"__SD_AUTHOR__",{
value:"¬© Prasidha Jagtap ‚Äì Seamless Dash",
writable:false
});
</script>
</body>
</html>
